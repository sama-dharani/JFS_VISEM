<!DOCTYPE html>
<html>
<head>
    <title>Batch-wise Timetable</title>

    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 80%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: lightblue;
        }
        .batch-title {
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
        }
        input, button {
            padding: 6px;
            margin: 5px 0;
        }
    </style>
</head>

<body>

<h2>Batch-wise Timetable</h2>

<!-- Upload CSV -->
<input type="file" id="csvFile" accept=".csv"><br><br>

<!-- Batch input -->
<input type="text" id="batchInput" placeholder="Enter Batch (e.g. VI-A)">
<button onclick="showBatchTimetable()">Show Timetable</button>

<div id="tables"></div>

<script>
let csvData = [];

document.getElementById("csvFile").addEventListener("change", function () {
    Papa.parse(this.files[0], {
        header: true,
        skipEmptyLines: true,
        complete: function (result) {
            csvData = result.data;
            alert("CSV file loaded successfully");
        }
    });
});

function showBatchTimetable() {
    const batchName = document.getElementById("batchInput").value.trim().toUpperCase();
    const container = document.getElementById("tables");
    container.innerHTML = "";

    if (!batchName) {
        alert("Please enter batch name");
        return;
    }

    const days = ["MON", "TUE", "WED", "THU", "FRI", "SAT"];

    // Initialize timetable
    let timetable = {};
    days.forEach(day => timetable[day] = { FN: "", AN: "" });

    csvData.forEach(row => {
        if (row["BATCH"] && row["BATCH"].toUpperCase() === batchName) {
            const day = row["DAY"]?.toUpperCase();
            const session = row["SESSION"]?.toUpperCase(); // FN / AN

            if (timetable[day] && (session === "FN" || session === "AN")) {
                timetable[day][session] =
                    `${row["COURSE"]}<br>
                     Room: ${row["ROOM"]}<br>
                     Faculty: ${row["FACULTY"]}`;
            }
        }
    });

    // Check if batch exists
    const hasData = Object.values(timetable)
        .some(d => d.FN !== "" || d.AN !== "");

    if (!hasData) {
        container.innerHTML = "<p>No timetable found for this batch</p>";
        return;
    }

    // Title
    const title = document.createElement("div");
    title.className = "batch-title";
    title.innerHTML = `Batch: ${batchName}`;
    container.appendChild(title);

    // Build table
    let tableHTML = `
        <table>
            <tr>
                <th>DAY</th>
                <th>FN</th>
                <th rowspan="7">L<br>U<br>N<br>C<br>H</th>
                <th>AN</th>
            </tr>
    `;

    days.forEach(day => {
        tableHTML += `
            <tr>
                <td>${day}</td>
                <td>${timetable[day].FN}</td>
                <td>${timetable[day].AN}</td>
            </tr>
        `;
    });

    tableHTML += "</table>";
    container.innerHTML += tableHTML;
}
</script>

</body>
</html>